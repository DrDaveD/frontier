<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Frontier Project Notes</title>
  </head>

  <body>
    <h1>Frontier Project Notes</h1>


<h2>Required Products</h2>

<ul>

<li> <a href="http://java.sun.com/">Java</a>
	<ul>
	    <li> Note that I've  used <a href="http://java.sun.com/j2se/1.5.0/download.jsp">Java 1.5</a> for my tomcat installation and for building frontier servlet code. Recent CMS tests were done using Java 1.4.2.

	</ul>

<li> <a href="http://ant.apache.org">Ant</a>
	<ul>
	    <li> Version: 1.6.5 (binary distribution can be downloaded <a href=" http://ant.apache.org/bindownload.cgi"> here </a>.
	    <li> This is needed for building frontier servlet code.

	</ul>


<li><a href="http://tomcat.apache.org">Tomcat</a>
	<ul>
	  <li> Version: <a href="http://tomcat.apache.org/download-55.cgi5">5.5.x series</a>
	  <li>
	  Installation: Fairly straightforward and described <a href="http://tomcat.apache.org/tomcat-5.5-doc/index.html">
here</a>. Note, however, that there are several external jars required: 
	    <ul>
	      <li>
	      <a href="http://xerces.apache.org/xerces2-j/">Xerces XML Java Parser </a> (<a href="http://www.apache.org/dist/xml/xerces-j">download</a>). Even though we've used one of the older (2.6.x) releases, the latest version (2.7.1) should be fine. Download the binary release and install xml-apis.jar and xercesImpl.jar  into tomcat's common/endorsed directory. 
		<li>
		<a href="http://www.oracle.com/technology/software/tech/java/sqlj_jdbc/index.html">Oracle JDBC Drivers</a>. The required library is ojdbc14_g.jar, and needs to be installed into tomcat's common/lib directory.

	      </ul>


	    <li> Frontier servlet deployment notes can be found <a href=" http://edge.fnal.gov:8888/frontier/">here</a>. In order to connect to the database, one has to to know the connect strings, frontier account username/password.

	</ul>

<li><a href="http://www.squid-cache.org/">Squid</a>

	<ul>
	  <li> Version: <a href="http://www.squid-cache.org/Versions/v2/2.5/">2.5.x series</a>
	    <li> Note that for recent tests we used slightly older version which Sergey compiled. This version also comes with installation scripts and can be found <a href="http://edge.fnal.gov:8888/frontier/dist/frontier_squid-1.0rc4.tar.gz">here</a>.

	    <li> Also useful are Sergey's and Lee's  
 <a href="http://lynx.fnal.gov/ntier-wiki/SquidForCMS">notes<a/> on the <a href="http://lynx.fnal.gov/ntier-wiki"> Frontier Wiki<a> page.
		    
           <li> Frontier code can be tested/used without squid installation.

	    </ul>

	<li> Frontier

	<ul>
	  <li> The CVS package is <em>frontier</em> in cdcvs (CVSROOT="CVSROOT cvsuser@cdcvs.fnal.gov:/cvs/cd"), and anyone should be able to check it out. 

	    <li> Notes about  servlet deployment and client installation, as well as the distribution of the latest client libraries can be found <a href=" http://edge.fnal.gov:8888/frontier/">here</a>. 

	    <li> Client code requires the <a href="http://expat.sourceforge.net/"> Expat XML Parser</a>. A fairly recent version (1.95.8) is in the frontier CVS package, and has been working well. Note that the same version is used by CMS software at the moment, so that right now there is no need to update expat libraries.


	  </ul>
</ul>


<h2>Building/Deploying Servlet </h2>
    
   
    <ol>
      <li> Install Java, Tomcat, and Ant
      <li>Check out frontier CVS package
      <li>Make sure ant/java are in your path
	<li>Modify file <em>build.local</em>: set value for property <em>catalina.home</em> to point to the root directory of your tomcat installation. For example, un my build.local file I've got

&lt;property name="catalina.home"     value="/scratch/veseli/devel/tomcat"/&gt

<li>To build the servlet code: ant -f build.local
<li>To build the servlet code and prepare war distribution file: ant -f build.local dist

<li> Here is an example of a servlet configuration file which is working on Tomcat 5.5.x:

<pre>
$ pwd
/scratch/veseli/devel/tomcat/conf/Catalina/localhost
$ cat FrontierCMS.xml
&lt;?xml version='1.0' encoding='utf-8'?&gt
&lt;Context debug="99" displayName="froNtier CMS Database Web Application" docBase="FrontierCMS" path="/FrontierCMS" reloadable="true"&gt
 &lt;Resource auth="Container" name="jdbc/frontiercms" type="javax.sql.DataSource" 
  url="jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(PORT=1521)(HOST=uscmsdb03.fnal.gov))(CONNECT_DATA=(SID=cmscald)))" 
  driverClassName="oracle.jdbc.driver.OracleDriver" validationQuery="select * from dual" maxIdle="1" 
  maxActive="2" maxWait="-1" username="cms_reader" password="reader" logAbandoned="true" /&gt

&lt;/Context&gt

</pre>

Note that older versions of Tomcat/Java (e.g., the one deployed on edge.fnal.gov) have the Resource Parameters specified separately (as opposed to via node attributes). This file is usually deployed in <em>conf/Catalina/localhost</em> relative to the Tomcat root directory (in the above example, the Tomcat root directory is <em>/scratch/veseli/devel/tomcat</em>).


<li> The other two configuration  files one has to worry about is the servlet deployment file <em>web.xml</em> (deployed in the <em>webapps/FrontierCMS/WEB-INF </em>), as well
as the configuration file <em>config.properties</em> (deployed in <em>webapps/FrontierCMS/WEB-INF/classes</em>).

<ul>
<li> Working example for Frontier <em>web.xml</em> file:

<pre>
$ pwd
/scratch/veseli/devel/tomcat/webapps/FrontierCMS/WEB-INF
$ cat web.xml
&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;

&lt;web-app&gt;
   &lt;display-name&gt;Frontier 3&lt;/display-name&gt;
   &lt;description&gt;Frontier 3 - XSD v2, writing, finders, etc.&lt;/description&gt;
   &lt;session-config&gt;
    &lt;session-timeout&gt;300&lt;/session-timeout&gt;   &lt;!-- 300 minutes --&gt;
   &lt;/session-config&gt;

   &lt;servlet&gt;
     &lt;servlet-name&gt;FrontierCMS&lt;/servlet-name&gt;
     &lt;servlet-class&gt;gov.fnal.frontier.FrontierServlet&lt;/servlet-class&gt;
     &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
   &lt;/servlet&gt;

   &lt;servlet-mapping&gt;
     &lt;servlet-name&gt;FrontierCMS&lt;/servlet-name&gt;
     &lt;url-pattern&gt;/Frontier&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;

   &lt;resource-ref&gt;
       &lt;description&gt;
            This is the refererence to the Oracle data source we
            use to talk to the database configured in server.xml.
       &lt;/description&gt;
       &lt;res-ref-name&gt;jdbc/frontiercms&lt;/res-ref-name&gt;
       &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
       &lt;res-auth&gt;Container&lt;/res-auth&gt;
   &lt;/resource-ref&gt;
&lt;/web-app&gt;
</pre>
 
<li> Working example for Frontier <em>config.properties</em> file:

<pre>
$ pwd
/scratch/veseli/devel/tomcat/webapps/FrontierCMS/WEB-INF/classes
$ cat config.properties
ServerName=FrontierCMS
DataSourceName=jdbc/frontiercms
XsdTableName=frontier_descriptors
#MonitorNode=MonAlisa_server_node_name
#MonitorMillisDelay=300000
UseFdoCache=no
#CacheExpireHourOfDay=5
#CacheExpireSeconds=86400

</pre>

</ul>

</ol>


</ol>



<h2>Building and Testing Frontier Access Plugin </h2>

The Frontier Access C++ Plugin is the primary means of accessing
Frontier from the CMS framework software.  The notes here include
examples that work on the lxplus.cern.ch cluster. 

<ol> 
  
<li> Copy/unpack the client distribution file in your work area on lxplus cluster:

<pre>

$ tar zxvf frontier_client__2.7.0__src.tar.gz
frontier_client__2.7.0__src/
...

</pre>

<li> Build client libraries

<pre>
$ cd frontier_client__2.7.0__src
$ make dist
...

</pre>

<li> Build frontier access plugin; example which prepares build area,
checks out necessary code, prepares environment, etc. is shown below.

<pre>
$ cat ~/bin/coralscram
#!/bin/bash
case $SCRAM_ARCH in
        *_dbg);;
        *) export SCRAM_ARCH=${SCRAM_ARCH}_dbg;;
esac
exec /afs/cern.ch/sw/lcg/app/spi/scram/scram "$@"
$ coralscram project CORAL CORAL_1_6_2
...
$ cd CORAL_1_6_2/src
$ eval `coralscram runtime -sh`
$ export CVSROOT=:pserver:anonymous@coral.cvs.cern.ch:/cvs/coral
$ cvs co -r CORAL_1_6_2 FrontierAccess
...
$ cd FrontierAccess
$ coralscram build
Configuring Local Area
...
$ cd tests/CmsNewFrontier
$ unitTest_FrontierAccess_CmsNewFrontier
...

</pre>

<li> Once the above is done, one has built frontier access plugin using
frontier libraries provided in the release. However, in order to test the
plugin with the frontier_client headers and libraries built in your work area,
one has to modify the scram setup:

<pre>
$ cd ../.. # if still in tests/CmsNewFrontier
$ coralscram setup -i -f /dev/null frontier_client
...
(copy and paste the full path to your frontier_client__2.7.0__src/dist
 directory as the FRONTIER_CLIENT_BASE, and for all others copy and paste
 the value it does an "existence check" just before prompting.)
...
$ eval `coralscram runtime -sh`
$ coralscram build clean
$ coralscram build
Configuring Local Area
...
$ cd tests/CmsNewFrontier
$ unitTest_FrontierAccess_CmsNewFrontier
...
</pre>

</ol>

<h2>Client release procedure</h2>

These are the steps to release the client:

<ol>

<li>
Update the RELEASE_NOTES with everything that has changed since the last version
<li>
Update the version number in Makefile
<li>
Commit all your changes to CVS
<li>
Set the cvs tag in client source directory in the format <tt>v2_7_0</tt>
<li>
<tt>make all-dist</tt>
<li>
<tt>scp tmp/* frontier@edge:frontier_web</tt>
<li>
<tt>ssh frontier@edge</tt> and edit frontier_web/index.html with the new
version numbers for the client sources and binary
<li>
<tt>scp tmp/*src* lxplus.cern.ch:/afs/cern.ch/sw/lcg/external/tarFiles</tt>
<li>
Fill out 
<a href=https://spi.cern.ch/login/requestAfsSpaceForm.php>
CERN Request AFS space for an external package</a>,
external package name <tt>frontier_client</tt>, version
of the form <tt>2.7.0</tt>, and volume name of the
form <tt>fnclnt270</tt>.
<li>
Send an email to <a href=mailto:project-lcg-peb-spi-support@cern.ch>
project-lcg-peb-spi-support@cern.ch</a> and ask them to build the
new frontier_client release and give them a copy of the release notes
for the new version.

</ol>

<h2>Servlet release procedure</h2>

These are the steps to release the frontier servlet:

<ol>

<li>
Update src/gov/fnal/frontier/RELEASE_NOTES with everything that has
changed since the last version
<li>
Update the version number in src/gov/fnal/frontier/FrontierServlet.java
<li>
Commit all your changes to CVS
<li>
Set a cvs tag at the level (above src and client) in the format
<tt>servlet_3_4</tt>.  This will unnecessarily add tags in the client
directory, which can optionally be removed with cvs tag -d in the
client directory.
<li>
In a scratch directory, and with CVSROOT set to
cvsuser@cdcvs.fnal.gov:/cvs/cd do
<br>
<tt>cvs co -r servlet_3_4 frontier</tt>
<li>
Prepare and release the sources:
<br>
<tt>mkdir Frontier_3_4</tt>
<br>
<tt>rsync -a --cvs-exclude --exclude /client frontier/ Frontier_3_4</tt>
<br>
<tt>tar zcf Frontier_servlet__3.4__src.tar.gz Frontier_3_4</tt>
<br>
<tt>scp Frontier_servlet__3.4__src.tar.gz frontier@edge:frontier_web</tt>
<li>
Prepare and release the binaries:
<br>
<tt>cd frontier</tt>
<br>
<tt>ant -f build.local clean</tt>
<br>
<tt>ant -Dcatalina.home=$CATALINA_HOME -f build.local dist</tt>
<br>
where CATALINA_HOME is set to the top level directory of a tomcat
installation.
<br>
<tt>scp dist/Frontier.war frontier@edge:frontier_web/Frontier_3.4.war</tt>
<li>
ssh frontier@edge and edit frontier_web/index.html with the new
version number for the server sources and binary
<li>
To install on the server:
<ul>
<li>
unpack the war file with "jar xf" in a new temporary directory
<li>
cd to WEB-INF in the temporary directory and save copies of web.xml
and classes/config.properties.  Copy in the old versions
of those files from the old tomcat directory
(/var/lib/tomcat5/webapps/SERVLET/WEB-INF where SERVLET is the servlet
name) and merge in any new changes from the release.
<li>
Rename the old SERVLET to something else and rename the new temporary
directory into its place.  This can be done while tomcat is live and it
should notice the update.
</ul>

</ol>

<hr>
<address><a href="mailto:dwd@fnal.gov">Dave Dykstra</a></address>
<!-- hhmts star -->
Last modified: 4 January 2007
<!-- hhmts end -->
</body>
</html>
